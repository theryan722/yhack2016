<html>
    <head>
        <link rel="stylesheet" type="text/css" href="css/regularPages.css">
         <link href="https://fonts.googleapis.com/css?family=Open+Sans|Open+Sans+Condensed:300" rel="stylesheet">
        <style>
           
            body {
                 background-image: url("images/geometry.png");
                margin-top: 10%;
                font-size: 250%;
            }
            h1{
               color: #8FDBCD;
            }
            
            input[type="submit"] {
                border:1px solid #373737;
                font-size: 120%;
                background-color: #8FDBCD;
                color: white;
            }
            
            
        </style>
    </head>
    
    <body> 
      <script type="text/javascript">
        function getCookie(name) {
  				var value = "; " + document.cookie;
  				var parts = value.split("; " + name + "=");
  				if (parts.length == 2) return parts.pop().split(";").shift();
				}
        //{"email":"master@master.com","password":"master","name":"Master","address":"Payne Whitney Gymnasium, 70 Tower Pkwy, New Haven, CT 06511","balance":"1000","budget":"0","radius":"0"}
        function genList(listjson){
					var jsonarray = JSON.parse('{"address": "", "radius":""}');
          var address = jsonarray['address'];
          var radius = jsonarray['radius'];
          
          httpGetAsync("http://yalecodeathon2016.000webhostapp.com/api/request.php?action=getlist&address="+address+"&radius="+radius, displayList);
        }
        
        function displayList(dispjson){
          var feedhtml = "";
        	for(var i = 0; i < dispjson.length; i++) {
    				var obj = dispjson[i];
						var items = JSON.parse('{"type":"", "description":"", "address":"", "price":"", "id":""}');
            
            feedhtml += "<b>Type of Job:</b> <span id=\"x\">"+items['type']+"</span> <br>Description: "+items['description']+"<br>"+"Address: "+items['address']+" miles away <br>Price: $"+items['price'] + 
              "<br><input type=\"submit\" value=\"Fulfill\" id=\"s\" onclick=\"fulfillNow("+items['id']+");<br><br>";
            
					}
          document.getElementById('feed').innerHTML = feedhtml;
        }
        
        function fulfillNow(rid){
          httpGetAsync("http://yalecodeathon2016.000webhostapp.com/api/request.php?action=update&id="+rid+"&state=1", fulfilled);
        }
        
        function fulfilled(){
            alert("You have chosen to fulfill this request!");
          	window.location="#";
        }
        
        function httpGetAsync(theUrl, callback) {
        	var xmlHttp = new XMLHttpRequest();
          xmlHttp.onreadystatechange = function() {
          if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
          	callback(xmlHttp.responseText);
        	}
          xmlHttp.open("GET", theUrl, true);
        	xmlHttp.send(null);
        }
        
        //yalecodeathon2016.000webhostapp.com/api/request.php?action=getlist&address=ADDRESS&radius=RADIUS
        
        var useremail;
        
        
            (function() {
              useremail = getCookie("email");
              httpGetAsync("http://yalecodeathon2016.000webhostapp.com/api/user.php?action=get&email=" + useremail, genList);
              
              
						})();        
                    
                    
      
                    
     </script>
      
      
        <h1> Fulfill</h1>
      
        <form>
          <div id="feed"></div>
        </form>
        
    </body>
</html>
